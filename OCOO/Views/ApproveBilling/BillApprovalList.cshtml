@model OCOO.Models.ApproveBilling
@{
    ViewData["Title"] = "Invoice Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .table th, .table thead th {
        color: #fff;
        vertical-align: middle;
        background: #21aee4 !important;
        border: 1px solid #1b9aca;
        text-align: center;
        padding: 5px 10px;
    }

    .table td {
        padding: 10px 10px;
        vertical-align: middle;
        text-align: right;
    }
</style>
<div class="page-wrapper">
    <div class="row page-titles">
        <div class="col-md-6 align-self-center">
            <h3 class="text-themecolor">Process Bill's</h3>
        </div>
        <div class="col-md-6 align-self-right">
            <button id="export-excel" class="btn btn-sm btn-success ml-2 float-right" title="Export to excel"><i class="fa fa-file-excel-o" aria-hidden="true"></i></button>
            <span class="float-right"><a data-toggle="collapse" href="#searchblock" role="button" aria-expanded="true" aria-controls="searchblock" class="btn btn-sm btn-primary" title="Search"><i class="fa fa-filter" aria-hidden="true"></i></a></span>
        </div>
    </div>
    <div class="container-fluid">
        <div class="collapse" id="searchblock">
            <div class="card">
                <input type="hidden" id="firmtemp" value="@TempData["firm"]" />
                <input type="hidden" id="stptemp" value="@TempData["stp"]" />
                <form asp-controller="ApproveBilling" asp-action="BillApprovalList">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>Zone</label>
                                    @Html.DropDownListFor(m => m.Pk_ZoneId, new SelectList(ViewBag.ddlZone, "Value", "Text"), new { @class = "form-control", @onchange = "return fGetFirmList()" })
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>Firm</label>
                                    @Html.DropDownListFor(m => m.Fk_FirmId, new SelectList(ViewBag.ddlFirm, "Value", "Text"), new { @class = "form-control", @onchange = "return fGetSTPList()" })
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>STP</label>
                                    @Html.DropDownListFor(m => m.Fk_STPId, new SelectList(ViewBag.ddlSTP, "Value", "Text"), new { @class = "form-control" })
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>Month</label>
                                    <div class="input-group">
                                        @Html.DropDownListFor(m => m.Fk_MonthId, new SelectList(ViewBag.ddlMonth, "Value", "Text"), new { @class = "form-control" })
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>From Date</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control mydatepicker" asp-for="FromDate" placeholder="dd/mm/yyyy" readonly>
                                        <div class="input-group-append">
                                            <span class="input-group-text"><i class="icon-calender"></i></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>To Date</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control mydatepicker" asp-for="ToDate" placeholder="dd/mm/yyyy" readonly>
                                        <div class="input-group-append">
                                            <span class="input-group-text"><i class="icon-calender"></i></span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-2 mt-4">
                                <div class="form-group mt-2">
                                    <button type="submit" class="btn btn-primary  btn-xs btn-sm " id="Submit" value="Search" name="btnSubmit"><i class="fa fa-search"></i> Search</button>
                                    <input type="button" value="Reset" class="btn btn-secondary btn-xs btn-sm" onclick="return Getreset();">
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="d-flex justify-content-end mb-3">
        </div>
        <div class="card">
            <form asp-action="STCRequestList">
                <div class="card-body p-3 pb-20">
                    <div class="table-responsive">
                        <table class="table table-hover footable">
                            <thead>
                                <tr>
                                    <th>Sn</th>
                                    <th>Month</th>
                                    <th>Year</th>
                                    <th>Firm</th>
                                    <th>Zone</th>
                                    <th style="display:none">Forwarded</th>
                                    <th style="display:none">Pending</th>
                                    <th>Approved</th>
                                    <th>Approval Details</th>
                                    <th>Bill Details</th>
                                    <th>OCEMS Details</th>
                                    <th>Bill Document</th>
                                    <th>Status</th>
                                   @* <th>Electricity Bill</th>
                                    <th>DG Bill</th>*@
                                    <th class="text-center">Measurement Acceptance</th>
                                   @*  <th class="text-center">Action</th> *@
                                </tr>
                            </thead>

                            <tbody>
                                @if (Model != null && Model.dtDetails != null && Model.dtDetails.Rows.Count > 0)
                                {
                                    for (int i = 0; i < Model.dtDetails.Rows.Count; i++)
                                    {
                                        <tr>
                                            <td class="text-center">@(i + 1)</td>
                                            <td class="text-center">@Model.dtDetails.Rows[i]["BillingMonth"].ToString()</td>
                                            <td class="text-center">@Model.dtDetails.Rows[i]["BillingYear"].ToString()</td>
                                            <td class="text-center nowrap">@Model.dtDetails.Rows[i]["FirmName"].ToString()</td>
                                            <td class="text-center nowrap">@Model.dtDetails.Rows[i]["Zone"].ToString()</td>
                                            <td class="text-center" style="display:none">
                                                @if (@Model.dtDetails.Rows[i]["IsForwarded"].ToString() == "true")
                                                {
                                                    <span>@Model.dtDetails.Rows[i]["ForwardBy"].ToString()</span>

                                                    <br />
                                                    <span class="badge badge-info">@Model.dtDetails.Rows[i]["ForwardBy_Des"].ToString()</span>

                                                    <br />
                                                    <span class="badge badge-primary">@Model.dtDetails.Rows[i]["ForwardBy_Dept"].ToString()</span>

                                                    <br />
                                                    <span class="badge badge-warning">@Model.dtDetails.Rows[i]["ForwardDate"].ToString()</span>
                                                }
                                            </td>
                                            <td class="text-center" style="display:none">
                                                @if (@Model.dtDetails.Rows[i]["IsPendingAT"].ToString() == "true")
                                                {
                                                    <span>@Model.dtDetails.Rows[i]["PendingAT"].ToString()</span>

                                                    <br />
                                                    <span class="badge badge-info">@Model.dtDetails.Rows[i]["PendingAT_Des"].ToString()</span>

                                                    <br />
                                                    <span class="badge badge-primary">@Model.dtDetails.Rows[i]["PendingAT_Dept"].ToString()</span>

                                                    <br />
                                                    <span class="badge badge-warning">@Model.dtDetails.Rows[i]["PendingDate"].ToString()</span>
                                                }
                                            </td>
                                            <td class="text-center">
                                                @if (@Model.dtDetails.Rows[i]["IsLastApprove"].ToString() == "true")
                                                {
                                                    <span>@Model.dtDetails.Rows[i]["LastApprovedBy"].ToString()</span>

                                                    <br />
                                                    <span class="badge badge-info">@Model.dtDetails.Rows[i]["LastApprovedBy_Des"].ToString()</span>

                                                    <br />
                                                    <span class="badge badge-primary">@Model.dtDetails.Rows[i]["LastApprovedBy_Dept"].ToString()</span>

                                                    <br />
                                                    <span class="badge badge-warning">@Model.dtDetails.Rows[i]["LastApprovedDate"].ToString()</span>
                                                }
                                            </td>
                                            <td class="text-center">
                                                <span class=""><a href="#" onclick="return fViewApprovalDetails('@Model.dtDetails.Rows[i]["PK_FbillId"].ToString()','@Model.dtDetails.Rows[i]["Pk_FirmId"].ToString()')"><i class="fa fa-eye" title="View Approval Details"></i></a></span>
                                            </td>
                                            <td class="text-center">
                                                <a target="_blank" href="/AdminReport/ViewInvoiceDetail?abc=@OCOO.Models.Crypto.Encrypt(Model.dtDetails.Rows[i]["PK_FbillId"].ToString())&&xyz=@OCOO.Models.Crypto.Encrypt(Model.dtDetails.Rows[i]["Pk_FirmId"].ToString())&&mpa=@OCOO.Models.Crypto.Encrypt("/ApproveBilling/BillApprovalList")">
                                                    <i class="fa fa-eye" title="View Invoice Details"></i>
                                                </a>
                                            </td>
                                            <td>
                                                <a target="_blank" href="/AdminReport/VerifySPS?abc=@OCOO.Models.Crypto.Encrypt(Model.dtDetails.Rows[i]["PK_FbillId"].ToString())&&xyz=@OCOO.Models.Crypto.Encrypt(Model.dtDetails.Rows[i]["Pk_FirmId"].ToString())&&mpa=@OCOO.Models.Crypto.Encrypt("/ApproveBilling/BillApprovalList")">
                                                    <i class="fa fa-eye" title="View SPS"></i>
                                                </a>
                                            </td>
                                            <td class="text-center">
                                                <a target="_blank" href="/AdminReport/BillDocument?xyz=@OCOO.Models.Crypto.Encrypt(Model.dtDetails.Rows[i]["PK_FbillId"].ToString())&&mpa=@OCOO.Models.Crypto.Encrypt("/ApproveBilling/BillApprovalList")">
                                                    <i class="fa fa-eye" title="View Bill Documents"></i>
                                                </a>
                                            </td>
                                            <td class="text-center" style="width:200px">
                                                @if (@Model.dtDetails.Rows[i]["BillStatus"].ToString() == "Approved" || @Model.dtDetails.Rows[i]["BillStatus"].ToString() == "Verified")
                                                {
                                                    <badge class="btn btn-outline-success btn-xs  badge fa fa-check-circle">
                                                        @Model.dtDetails.Rows[i]["BillStatus"].ToString()
                                                    </badge>

                                                }
                                                else if (@Model.dtDetails.Rows[i]["BillStatus"].ToString() == "Decline")
                                                {
                                                    <badge class="btn btn-outline-danger btn-xs  badge fa fa-times-circle">
                                                        @Model.dtDetails.Rows[i]["BillStatus"].ToString()
                                                    </badge>
                                                }
                                                else
                                                {
                                                    if (Model.dtDetails.Rows[i]["IsEnabled"].ToString() == "True")
                                                    {
                                                        if (Model.DesignationId != 4 || (Model.DesignationId == 4 && !new List<int> { 3, 24, 13 }.Contains(Model.DepartmentId)))
                                                        {
                                                            <a class="btn btn-outline-warning btn-xs  badge fa fa-clock-o" href="/Bill/ProcessBill?id=@OCOO.Models.Crypto.Encrypt(@Model.dtDetails.Rows[i]["PK_FbillId"].ToString())" title="Click and proceed for further process">
                                                                @Model.dtDetails.Rows[i]["BillStatus"].ToString()
                                                            </a>
                                                        }
                                                        else if (Model.DesignationId == 4 && new List<int> { 3, 24, 13 }.Contains(Model.DepartmentId))
                                                        {
                                                                <a class="btn btn-outline-warning btn-xs  badge fa fa-clock-o" href="/Bill/BillSTPWiseApproval?id=@OCOO.Models.Crypto.Encrypt(Model.dtDetails.Rows[i]["PK_FbillId"].ToString())&&xyz=@OCOO.Models.Crypto.Encrypt(Model.dtDetails.Rows[i]["Pk_FirmId"].ToString())&&uvw=@OCOO.Models.Crypto.Encrypt(Model.dtDetails.Rows[i]["Inv_Month"].ToString())&&mpa=@OCOO.Models.Crypto.Encrypt("/ApproveBilling/BillApprovalList")" title="Click and proceed for further process">
                                                                    @Model.dtDetails.Rows[i]["BillStatus"].ToString()
                                                                </a>
                                                        }
                                                        else
                                                        {
                                                            if (!string.IsNullOrEmpty(Model.dtDetails.Rows[i]["BillStatus"].ToString()))
                                                            {
                                                                <badge class="btn btn-outline-info btn-xs  badge fa fa-forward"> @Model.dtDetails.Rows[i]["BillStatus"].ToString()</badge>
                                                            }                                                            
                                                        }
                                                    }
                                                }
                                            </td>

                                           @* <td class="text-center">
                                                <a class="btn btn-outline-warning btn-xs  badge fa fa-clock-o" href="/Bill/ElectricityBill?abc=@OCOO.Models.Crypto.Encrypt(Model.dtDetails.Rows[i]["PK_FbillId"].ToString())" title="" target="_blank"> Electricity Bill</a>
                                            </td>*@
                                            @*<td class="text-center">
                                                <a class="btn btn-outline-warning btn-xs  badge fa fa-clock-o" href="/Bill/DGBill?id=@OCOO.Models.Crypto.Encrypt(Model.dtDetails.Rows[i]["PK_FbillId"].ToString())" title="" target="_blank"> DG Bill</a>
                                            </td>*@

                                            <td class="text-center">
                                                @if (Model.dtDetails.Rows[i]["FirmVerified"].ToString() == "Verified")
                                                {
                                                    <a class="text-success" onclick="return VerifiedMonthlyBill('@Model.dtDetails.Rows[i]["PK_FbillId"].ToString()')" href="javascript:void(0)"><span class="badge badge-success fa fa-check-circle" style="font-size: 12px;">Verified</span></a>
                                                }


                                            </td>
                                           @*  <td class="text-center">
                                                <a class="text-primary" href="/ApproveBilling/BillLog?abc=@OCOO.Models.Crypto.Encrypt(@Model.dtDetails.Rows[i]["PK_FbillId"].ToString())" target="_blank"><i class="fa fa-file" title="view bill history"></i></a>
                                            </td> *@
                                        </tr>
                                    }
                                }
                            </tbody>
                        </table>

                    </div>
                </div>

            </form>
        </div>
    </div>
</div>

<form asp-action="ApproveBill" asp-controller="ApproveBilling" enctype="multipart/form-data">
    <div id="modelDegination" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true" data-keyboard="false" data-backdrop="static">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Approve Bill</h5>
                    <a href="#" class="btn-close" data-dismiss="modal">
                        <i class="fa fa-close"></i>
                    </a>
                </div>
                <div class="modal-body">
                    <div class="text-center">
                        <a class="btn btn-primary" id="btnForward" onclick="return fOnlyForward()" aria-current="page" href="#">Only Forward</a>
                        <a class="btn btn-warning" href="#" id="btnApprove" onclick="return fApproveForward()">Approve/Decline</a>

                    </div>
                    <div class="d-none" id="ForwardForm">
                        <fieldset>
                            <legend>Only Forward</legend>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label>Forward To<span class="text-danger">*</span></label>
                                        <select class="form-control" asp-for="ForwardTo"></select>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label>Remarks<span id="" class="text-danger d-none">*</span></label>
                                        <textarea class="form-control" asp-for="ForwardRemarks" placeholder="Remarks"></textarea>
                                    </div>
                                </div>
                                <div class="col-md-12 text-right mb-3">
                                    <input type="submit" class="btn btn-success" onclick="return fValidateForward()" id="submit" value="Forward" name="btnSubmit" />
                                </div>
                            </div>
                        </fieldset>
                    </div>

                    <div class="d-none" id="ApproveForm">
                        <fieldset>
                            <legend>Approve/Decline</legend>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <input type="hidden" asp-for="Firm" />
                                        <input type="hidden" asp-for="Pk_EmployeeId" />
                                        <input type="hidden" asp-for="BillId" />
                                        <label>Document<span class="text-danger">*</span></label>
                                        <input type="file" class="form-control" asp-for="ApproveDocuments" placeholder="Upload Document" onchange="return ValidateFiles(this)" />
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Status<span class="text-danger">*</span></label>
                                        <select asp-for="Status" class="form-control" onchange="return fEmployeeDDl()">
                                            <option value="0">--Select--</option>
                                            <option value="Approved">Approve</option>
                                            <option value="Decline">Decline</option>
                                            <option value="Paid">Paid</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Forward To<span id="txtfwdTo" class="text-danger">*</span></label>
                                        <select class="form-control" asp-for="ApproveAndForward">
                                            <option value="0">--select--</option>
                                        </select>
                                    </div>
                                </div>
                                @if (Context.Session.GetString("Fk_DesignationId") == "4")
                                {
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Fuel Charges</label>
                                            <input type="text" class="form-control" asp-for="FuelCharges" onkeypress="return isNumberKey(this)" placeholder="Enter Fuel Charges" />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Fuel Charges Document</label>
                                            <input type="file" class="form-control" asp-for="FuelChargesDocuments" placeholder="Fuel Charges Documents" onchange="return ValidateFiles(this)" />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>LD Charges</label>
                                            <input type="text" class="form-control" asp-for="OtherLdCharges" placeholder="Enter Other LD Charges" />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>LD Charges Documents</label>
                                            <input type="file" class="form-control" asp-for="OtherLdChargesDocuments" placeholder="Other LD Charges Documents" onchange="return ValidateFiles(this)" />
                                        </div>
                                    </div>
                                }

                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Remarks<span id="ValidateRemark" class="text-danger d-none">*</span></label>
                                        <textarea class="form-control" asp-for="Remarks" placeholder="Remarks"></textarea>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <input type="checkbox" asp-for="Isdeclaration" id="Isdeclaration" />
                                        <label style="padding-top:3px;" for="Isdeclaration"><span class="text-danger">* </span> It is hereby declared that the details mentioned here/above are true and correct.</label>
                                    </div>
                                </div>

                                <div class="col-md-12 text-right mb-3">
                                    <input type="submit" class="btn btn-success" id="submit" onclick="return ValidateForm();" value="Submit" name="btnSubmit" />
                                </div>
                            </div>

                        </fieldset>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger waves-effect text-left" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</form>

<div id="approveDetails" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true" data-keyboard="false" data-backdrop="static">
    <div class="modal-dialog modal-xl modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Bill Approval Details</h5>
                <a href="#" class="btn-close" data-dismiss="modal">
                    <i class="fa fa-close"></i>
                </a>
            </div>
            <div class="modal-body" style="padding:1px; scroll-behavior:auto">
                <div class="table-responsive" tabindex="-1">
                    <table class="table table-striped table-bordered" id="tbtApprovedDetails">
                        <thead>
                            <tr>
                                <th>S.No.</th>
                                <th>Officer</th>                              
                                <th>Narration</th>
                                <th>Documents</th>
                                <th>System Narration</th>
                                <th>Status</th>
                                <th style="white-space:nowrap">Pending Since</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
@{

    Html.RenderPartial("_VerifiedMonthlyBill");

}
<script src="~/script/viewbilldetails.js"></script>

<script>
    $(document).ready(function () {
        document.getElementById('export-excel').addEventListener('click', function () {
            // Get table data
            var table = document.getElementById('data-table');
            var data = XLSX.utils.table_to_sheet(table);

            // Create a workbook
            var wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, data, 'Zone Wise Invoice Report');

            // Export the workbook as a downloadable Excel file
            XLSX.writeFile(wb, 'Billing_Report.xlsx');
        });


        document.getElementById('export-pdf').addEventListener('click', function () {
            // Get table data
            var table = document.getElementById('data-table');

            // Create a new jsPDF instance
            var pdf = new jsPDF();

            // Convert the table to a PDF
            pdf.autoTable({ html: table });

            // Save the PDF as a downloadable file
            pdf.save('table_data.pdf');
        });
    })

    $("#Status").change(function () {
        if ($("#Status").val() === 'Decline') {
            $("#ValidateRemark").removeClass("d-none");
        }
        else {
            $("#ValidateRemark").addClass("d-none");
        }
    })

    function ValidateForm() {
        if ($("#ApproveDocuments").val() == null || $("#ApproveDocuments").val() == '') {
            $("#ApproveDocuments").focus();
            return false;
        }
        if ($("#Status").val() == null || $("#Status").val() == '' || $("#Status").val() == '0') {
            $("#Status").focus();
            return false;
        }
        if ($("#Status").val() == 'Decline') {
            if ($("#Remarks").val() == null || $("#Remarks").val() == '') {
                $("#Remarks").focus();
                return false;
            }
        }
        if ($("#Status").val() != "Paid") {
            if ($("#ApproveAndForward").val() == '' || $("#ApproveAndForward").val() == '0') {
                if ($("#ApproveAndForward").val() == null || $("#ApproveAndForward").val() == '') {
                    $("#ApproveAndForward").focus();
                    $("#txtfwdTo").addClass("d-none");
                    return false;
                }
            }
        }
        if ($("#Isdeclaration").is(':checked') == false) {
            fShowToastalert('Please Select declaration Box !');
            $("#Isdeclaration").focus();
            return false;
        }
    }

    function fApproveForm(txtBillId, txtFirmId) {
        $("#Firm").val(txtFirmId);
        $("#BillId").val(txtBillId);
        $("#ApproveDocuments").val('');
        $("#Status").val('0');
        $("#Remarks").val('');
        $("#ForwardRemarks").val('');
        $("#Isdeclaration").prop('checked', false);
        $('#modelDegination').modal('show');
        $("#ForwardForm").addClass('d-none');
        $("#ApproveForm").addClass('d-none');

        $.ajax({
            url: '/ApproveBilling/GetEmployeeddl',
            type: 'GET',
            data: { FirmId: txtFirmId, BillId: txtBillId },
            success: function (response) {
                if (response != null) {
                    let ddl = '';
                    $("#ApproveAndForward").empty();
                    for (let i = 0; i < response.length; i++) {
                        ddl += `<option value="${response[i].id}">${response[i].name}</option>`
                    }
                    $("#ApproveAndForward").append(ddl);
                }
            },
            error: function (error) {
                fShowToasterror(error);
            }
        })

        $.ajax({
            url: '/ApproveBilling/GetEmployeeddl',
            type: 'GET',
            data: { FirmId: txtFirmId, BillId: txtBillId },
            success: function (response) {
                if (response != null) {
                    let ddl = '';
                    $("#ForwardTo").empty();
                    for (let i = 0; i < response.length; i++) {
                        ddl += `<option value="${response[i].id}">${response[i].name}</option>`
                    }
                    $("#ForwardTo").append(ddl);
                }
            },
            error: function (error) {
                fShowToasterror(error);
            }
        })
    }

    function fViewApprovalDetails(txtBillId, txtFirmId) {
        $.ajax({
            url: '/ApproveBilling/BillApprovalHistory',
            type: 'GET',
            data: { BillId: txtBillId, FirmId: txtFirmId },
            success: function (response) {
                console.log(response);
                if (response != null) {
                    let str = "";
                    let srno = 1;
                    $("#tbtApprovedDetails tbody").html('');
                    for (let i = 0; i < response.length; i++) {
                        const srno = i + 1;
                        var StatusLabel = 'info';
                        var icon = '';
                        if (response[i].status === 'Approved') {
                            StatusLabel = "success";
                            icon = 'check-circle';
                        }
                        else if (response[i].status === 'Pending') {
                            StatusLabel = "warning";
                            icon = 'clock-o';
                        }
                        else if (response[i].status === 'Decline') {
                            StatusLabel = "danger";
                            icon = 'times-circle';
                        }
                        else if (response[i].status === 'Marked') {
                            StatusLabel = "primary";
                            icon = 'map-pin';
                        }
                        else if (response[i].status === 'Forwarded') {
                            StatusLabel = "info";
                            icon = 'forward';
                        }
                        else if (response[i].status.toLowerCase() == "verified") {
                            StatusLabel = "success";
                            icon = 'check-circle';
                        }
                        else if (response[i].status.toLowerCase() == "paid") {
                            StatusLabel = "default";
                            icon = 'check';
                        }
                        str += `<tr>
                                                    <td class="text-center">${srno}</td>
                                                    <td class="text-center">${response[i].name}</td>
                                                    <td class="text-center">${response[i].remarks}</td>
                                                    <td class="text-center">
                                                    ${response[i].approveDocumentsURL === '' ? '' : `<a target="_blank" href="${response[i].approveDocumentsURL}" alt="Document Image" title="Click and see covering letter"><i class="fa fa-file" aria-hidden="true"></i></a>`}
                                                    &nbsp;  &nbsp;  ${response[i].ld_DocumentsURL === '' ? '' : `<a target="_blank" href="${response[i].ld_DocumentsURL}" alt="Document Image" title="Click and see LD letter"><i class="fa fa-file" aria-hidden="true"></i></a>`}
                                                    </td>
                                                    <td class="text-center">${response[i].toRemark}</td>
                                                    <td class="text-center"><span class="badge badge-${StatusLabel}"> <i class="fa fa-${icon}" aria-hidden="true"></i> ${response[i].status}</span></td>
                                                     <td class="text-center">${response[i].addedOn}</td>
                                                    <td class="text-center">${response[i].approvedDate}</td>
                                                                                                                                        </tr>`;
                    }
                    $("#tbtApprovedDetails tbody").html(str);
                }
            },
            error: function (error) {
                fShowToasterror(error);
            }
        });
        $('#approveDetails').modal('show');
    }

    function fValidateForward() {
        if ($("#ForwardTo").val() == null || $("#ForwardTo").val() == "") {
            $("#ForwardTo").focus();
            return false;
        }
        if ($("#ForwardRemarks").val() == null || $("#ForwardRemarks").val() == "") {
            $("#ForwardRemarks").focus();
            return false;
        }
    }

    function fOnlyForward(txtBillId, txtFirmId) {
        $("#ForwardForm").removeClass('d-none');
        $("#ApproveForm").addClass('d-none');
        $("#btnForward").addClass('active');
        $("#btnApprove").removeClass('active');
    }

    function fApproveForward(txtBillId, txtFirmId) {
        $("#ApproveForm").removeClass('d-none');
        $("#ForwardForm").addClass('d-none');
        $("#btnApprove").addClass('active');
        $("#btnForward").removeClass('active');
    }

    function fEmployeeDDl() {
        let txtFirmId = $("#Firm").val();
        let txtBillId = $("#BillId").val();

        if ($("#Status").val() === 'Decline') {
            $.ajax({
                url: '/ApproveBilling/GetEmployeeddlForReject',
                type: 'GET',
                data: { FirmId: txtFirmId, BillId: txtBillId },
                success: function (response) {
                    if (response != null) {
                        let ddl = '';
                        $("#ApproveAndForward").empty();
                        for (let i = 0; i < response.length; i++) {
                            ddl += `<option value="${response[i].id}">${response[i].name}</option>`
                        }
                        $("#ApproveAndForward").append(ddl);
                    }
                },
                error: function (error) {
                    fShowToasterror(error);
                }
            })
        }
    }


</script>
<script src="~/script/frimstpbind.js"></script>
<script>
    $(document).ready(function () {
        debugger;
        var firmID = $('#firmtemp').val();
        var stpID = $('#stptemp').val();
        if (firmID != null && stpID != null) {
            fGetFirmList(firmID);
            fGetSTPList(firmID, stpID);
        }
    });

    function Getreset() {
        debugger;
        $('#Pk_ZoneId').val(null);
        $('#Fk_FirmId').val('0');
        $('#Fk_STPId').val('0');
        $('#Fk_MonthId').val('0');
        $('#FromDate').val('');
        $('#ToDate').val('');
        fGetFirmList();
        fGetSTPList();
    }
</script>


